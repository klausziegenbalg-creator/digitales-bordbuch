<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digitales Bordbuch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .container { max-width: 900px; }
        .card { background-color: white; border-radius: 1rem; box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        .header-bg { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        /* Style für fehlerhafte Eingabefelder */
        input[aria-invalid="true"], textarea[aria-invalid="true"] {
            border-color: #ef4444; 
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
        }
        .critical-error { background-color: #fee2e2; color: #991b1b; padding: 1rem; border-radius: 0.5rem; border: 1px solid #f87171; margin-bottom: 1rem; display: none; }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="error-message" class="critical-error" role="alert">
        <strong class="font-bold">Kritischer Fehler:</strong> 
        <span id="error-details">Die Anwendung konnte nicht korrekt initialisiert werden. Bitte überprüfen Sie die Konsolenausgabe.</span>
    </div>

    <div class="container mx-auto">
        <div class="header-bg p-6 text-white rounded-t-xl">
            <h1 class="text-3xl font-bold">Digitales Bordbuch</h1>
            <p class="mt-1 text-emerald-200">Automatenservice Schiemann | Standorte: Sterncenter Potsdam / Havelpark Dallgow</p>
        </div>

        <!-- Benutzer- und Standortinformationen -->
        <div class="card p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Aktuelle Sitzung</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-3 bg-gray-50 rounded-lg">
                    <p class="text-sm font-medium text-gray-500">Standort</p>
                    <p class="text-lg font-bold text-gray-800" id="current-location">Sterncenter Potsdam</p>
                </div>
                <div class="p-3 bg-gray-50 rounded-lg">
                    <p class="text-sm font-medium text-gray-500">User ID</p>
                    <p class="text-sm font-mono text-gray-800 break-all" id="user-id">Wird geladen...</p>
                </div>
                <div class="p-3 bg-gray-50 rounded-lg">
                    <p class="text-sm font-medium text-gray-500">App ID</p>
                    <p class="text-sm font-mono text-gray-800 break-all" id="app-id">Wird geladen...</p>
                </div>
            </div>
            
            <div class="mt-4 flex flex-wrap gap-4">
                <button onclick="changeLocation('Sterncenter Potsdam')" class="px-4 py-2 font-semibold rounded-lg transition duration-150" id="btn-potsdam">
                    Sterncenter Potsdam (2x)
                </button>
                <button onclick="changeLocation('Havelpark Dallgow')" class="px-4 py-2 font-semibold rounded-lg transition duration-150" id="btn-dallgow">
                    Havelpark Dallgow (1x)
                </button>
            </div>
        </div>

        <!-- Reinigungsdokumentation (Wird über JS dynamisch befüllt) -->
        <div class="card p-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Reinigungs-Checkliste</h2>
            <form id="cleaning-form">
                <p id="loading-checklist" class="text-gray-500">Checkliste wird vorbereitet...</p>
                <!-- Checkliste wird hier dynamisch eingefügt -->
            </form>
            <button id="save-log-btn" class="w-full mt-6 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl transition duration-300 disabled:opacity-50" disabled>
                Protokoll speichern
            </button>
            <p id="save-status" class="mt-2 text-sm text-center text-gray-600 hidden"></p>
        </div>

        <!-- Letzte Protokolle (Anzeige der gespeicherten Daten) -->
        <div class="card p-6 mt-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Letzte Protokolle</h2>
            <div id="log-list" class="space-y-3">
                <p class="text-gray-500">Daten werden geladen...</p>
            </div>
        </div>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            setPersistence,
            inMemoryPersistence 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            collection, 
            query, 
            onSnapshot,
            limit 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Globale Variablen (MANDATORY from Canvas Environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : ''; 
        let firebaseConfig = null;
        
        // Flag, um festzustellen, ob wir im Vorschau-Modus (mit Dummy-Config) laufen
        let isDummyMode = false;

        try {
            // 1. VERSUCHE ECHTE KONFIGURATION ZU LADEN
            if (typeof __firebase_config !== 'undefined' && __firebase_config && __firebase_config.trim() !== '') {
                firebaseConfig = JSON.parse(__firebase_config);
            }
        } catch (e) {
            console.error("Firebase Config JSON Parse Fehler (Umgebungsvariable):", e);
        }

        // 2. WENN ECHTE KONFIGURATION FEHLT, SIMULIERE EINE PLATZHALTER-KONFIGURATION
        if (!firebaseConfig) {
            console.warn("WARNUNG: Globale Firebase-Konfiguration fehlt. Verwende Platzhalter-Konfiguration für die Vorschau.");
            isDummyMode = true;
            // Dummy-Konfiguration, damit initializeApp() nicht fehlschlägt.
            firebaseConfig = {
                apiKey: "AIzaSy_TEST_DUMMY_KEY",
                authDomain: "dummy-app.firebaseapp.com",
                projectId: "dummy-project-id",
                storageBucket: "dummy-app.appspot.com",
                messagingSenderId: "1234567890",
                appId: "1:1234567890:web:dummy12345"
            };
        }


        // --- DOM Elemente und Initialisierung ---
        const logList = document.getElementById('log-list');
        const userIdDisplay = document.getElementById('user-id');
        const appIdDisplay = document.getElementById('app-id');
        const locationDisplay = document.getElementById('current-location');
        const saveButton = document.getElementById('save-log-btn');
        const saveStatus = document.getElementById('save-status');
        const errorDiv = document.getElementById('error-message');
        const errorDetailsSpan = document.getElementById('error-details');
        const form = document.getElementById('cleaning-form');
        const loadingChecklist = document.getElementById('loading-checklist');
        
        appIdDisplay.textContent = appId;
        userIdDisplay.textContent = 'Wird geladen...'; 

        // --- Firebase Instanzen ---
        let app, db, auth, currentUserId = null;
        let currentLocation = 'Sterncenter Potsdam';
        let isAuthReady = false;
        let firebaseEnabled = false; 


        // --- Checkliste-Daten ---
        const checklistItems = [
            { id: 'brenner', text: 'Brenner immer reinigen (inkl. Roboterarm)', required: true },
            { id: 'freshwater', text: 'Frischwasserbehälter auffüllen (Niemals Leitungswasser! Nur gekauftes Wasser!)', required: true, checkType: 'text', placeholder: 'Verwendete Wassermarke (z.B. ETOILE)' },
            { id: 'wastewater', text: 'Abwasserbehälter täglich leeren', required: true },
            { id: 'sugar_white', text: 'Weißer Zucker bis zum Punkt füllen', required: true, checkType: 'inventory', unit: '%', min: 75, max: 100 },
            { id: 'sugar_rough', text: 'Rauer Zucker bis zum Punkt füllen', required: true, checkType: 'inventory', unit: '%', min: 75, max: 100 },
            { id: 'sugar_yellow', text: 'Gelber Zucker bis zum Punkt füllen', required: true, checkType: 'inventory', unit: '%', min: 75, max: 100 },
            { id: 'sugar_red', text: 'Roter Zucker bis zum Punkt füllen', required: true, checkType: 'inventory', unit: '%', min: 75, max: 100 },
            { id: 'sticks', text: 'Stäbchen bis zum oberen Rand füllen (ca. 300 Stück)', required: true, checkType: 'inventory', unit: 'Stück', min: 250, max: 300 },
            { id: 'exterior', text: 'Automat von außen reinigen (inkl. aller Scheiben innen/außen mit Scheibenreiniger)', required: true },
            { id: 'photo', text: 'Fotodokumentation per WhatsApp an den Auftraggeber gesendet', required: true },
            { id: 'notes', text: 'Anmerkungen / Sonderfälle', required: false, checkType: 'textarea', placeholder: 'Geben Sie hier Beobachtungen oder Probleme ein.' }
        ];

        // --- Fehlerbehandlung anzeigen (Nur bei kritischem Fehler, der Auth/Config blockiert) ---
        function displayCriticalError(message, details = null) {
            console.error('CRITICAL ERROR:', message, details);
            errorDetailsSpan.textContent = message + (details ? ': ' + details : '');
            errorDiv.style.display = 'block';
            saveButton.disabled = true;
            loadingChecklist.style.display = 'none'; 
            
            // Im Dummy-Modus zeigen wir die Checkliste trotzdem an, aber deaktiviert.
            if (!isDummyMode) {
                form.innerHTML = '<p class="text-red-600 font-semibold">Anwendungsfehler. Speichern und Laden nicht möglich.</p>';
            }
            logList.innerHTML = '<p class="text-red-600 font-semibold">Fehler beim Laden der Protokolle.</p>';
        }

        // --- Firebase Initialisierung und Authentifizierung (Zwingend) ---
        async function initializeFirebase() {
            try {
                // ECHTE INITIALISIERUNG
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                firebaseEnabled = true; 
                
                // Setze Persistenz auf in-memory, um Probleme mit der iFrame-Speicherung zu vermeiden
                await setPersistence(auth, inMemoryPersistence);

                if (initialAuthToken && initialAuthToken.trim() !== '') {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // WENN wir Dummy-Config haben, wird dieser Aufruf fehlschlagen (was wir erwarten)
                    await signInAnonymously(auth);
                }

                // Warten auf den finalen Auth State
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        userIdDisplay.textContent = currentUserId;
                        isAuthReady = true;
                        
                        if (isDummyMode) {
                            // Dummy-Modus: Zeige UI, aber verhindere DB-Zugriff und Speichern
                            displayCriticalError('WARNUNG: Vorschau-Modus aktiv.', 
                                'Datenbankzugriff und Speichern sind in der Vorschau nicht möglich. Bitte stellen Sie die App live bereit, um die Funktionalität zu testen.'
                            );
                            setupUI();
                            saveButton.disabled = true;
                            logList.innerHTML = '<p class="text-gray-500 font-semibold">Daten werden nicht geladen (Vorschau-Modus aktiv).</p>';
                        } else {
                            // Echte Konfig ist aktiv
                            setupUI(); 
                            listenForLogs(); 
                        }

                    } else {
                        // Dieser Fall tritt auch im Dummy-Modus auf, wenn signInAnonymously fehlschlägt (auth/key-not-valid)
                        if (!isDummyMode) {
                            displayCriticalError('Authentifizierungsfehler: Benutzer nicht angemeldet.', 
                                'Token ungültig oder abgelaufen. Speichern und Laden nicht möglich.'
                            );
                        } else {
                            // Wenn Dummy-Modus, rufen wir trotzdem setupUI auf, um die Checkliste anzuzeigen
                            setupUI();
                            // Die Critical Error Meldung wird bereits durch den try/catch Block unten ausgelöst
                        }
                    }
                });
            } catch (e) {
                // Fängt den tatsächlichen Firebase Auth Fehler ab (z.B. key-not-valid)
                if (isDummyMode) {
                    // Im Dummy-Modus ist dieser Fehler erwartet.
                    displayCriticalError('WARNUNG: Vorschau-Modus aktiv.', 
                                'Datenbankzugriff und Speichern sind in der Vorschau nicht möglich. Bitte stellen Sie die App live bereit, um die Funktionalität zu testen. (Firebase Auth Fehler: ' + e.code + ')'
                    );
                    setupUI();
                    saveButton.disabled = true;
                    logList.innerHTML = '<p class="text-gray-500 font-semibold">Daten werden nicht geladen (Vorschau-Modus aktiv).</p>';

                } else {
                    // Im echten Modus wäre dies ein Fehler in der Konfiguration
                    displayCriticalError('Unbekannter Initialisierungsfehler', e.message);
                }
            }
        }
        
        // --- UI Setup & Events ---
        function setupUI() {
            loadingChecklist.style.display = 'none'; 
            renderChecklist();
            
            // Deaktiviert alle Eingabefelder im Dummy-Modus
            if (isDummyMode) {
                 document.querySelectorAll('#cleaning-form input, #cleaning-form textarea').forEach(el => el.disabled = true);
            }
            
            // Stelle sicher, dass der Event-Listener nur einmal hinzugefügt wird
            if (!saveButton.hasListener) {
                saveButton.addEventListener('click', saveLog);
                saveButton.hasListener = true;
            }
            updateLocationUI(currentLocation);
        }

        function changeLocation(newLocation) {
            currentLocation = newLocation;
            updateLocationUI(newLocation);
        }

        function updateLocationUI(location) {
            locationDisplay.textContent = location;
            document.getElementById('btn-potsdam').className = 'px-4 py-2 font-semibold rounded-lg transition duration-150 ' + (location === 'Sterncenter Potsdam' ? 'bg-emerald-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300');
            document.getElementById('btn-dallgow').className = 'px-4 py-2 font-semibold rounded-lg transition duration-150 ' + (location === 'Havelpark Dallgow' ? 'bg-emerald-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300');
        }

        function renderChecklist() {
            form.innerHTML = ''; 
            checklistItems.forEach(item => {
                let inputHtml = '';
                const baseId = `check-${item.id}`;

                if (item.checkType === 'text') {
                    inputHtml = `
                        <input type="text" id="${baseId}" name="${item.id}" placeholder="${item.placeholder}" class="mt-1 block w-full border border-gray-300 rounded-lg p-2 focus:ring-emerald-500 focus:border-emerald-500" ${isDummyMode ? 'disabled' : ''}>
                    `;
                } else if (item.checkType === 'textarea') {
                    inputHtml = `
                        <textarea id="${baseId}" name="${item.id}" placeholder="${item.placeholder}" rows="3" class="mt-1 block w-full border border-gray-300 rounded-lg p-2 focus:ring-emerald-500 focus:border-emerald-500" ${isDummyMode ? 'disabled' : ''}></textarea>
                    `;
                } else if (item.checkType === 'inventory') {
                    inputHtml = `
                        <div class="flex items-center space-x-2 mt-1">
                            <input type="number" id="${baseId}-val" name="${item.id}-val" min="${item.min}" max="${item.max}" placeholder="${item.min} - ${item.max}" class="w-24 border border-gray-300 rounded-lg p-2 text-center focus:ring-emerald-500 focus:border-emerald-500" ${isDummyMode ? 'disabled' : ''}>
                            <span class="text-gray-600">${item.unit}</span>
                            <input type="checkbox" id="${baseId}-full" name="${item.id}-full" class="h-5 w-5 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500 ml-4" ${isDummyMode ? 'disabled' : ''}>
                            <label for="${baseId}-full" class="text-sm text-gray-700">Auffüllen (Voll)</label>
                        </div>
                    `;
                } else {
                    // Standard Checkbox
                    inputHtml = `
                        <input type="checkbox" id="${baseId}" name="${item.id}" class="h-6 w-6 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500" ${isDummyMode ? 'disabled' : ''}>
                    `;
                }
                
                const requiredAsterisk = item.required ? '<span class="text-red-500">*</span>' : '';
                
                // Anpassung, um die Checkbox oder das Input-Feld korrekt zu positionieren
                let mainContentHtml = '';
                let controlHtml = '';
                
                if (item.checkType === undefined || item.checkType === 'checkbox') {
                    mainContentHtml = `
                        <label for="${baseId}" class="text-base font-medium text-gray-800">
                            ${item.text} ${requiredAsterisk}
                        </label>
                    `;
                    controlHtml = inputHtml;
                } else {
                    mainContentHtml = `
                        <label for="${baseId}" class="text-base font-medium text-gray-800">
                            ${item.text} ${requiredAsterisk}
                        </label>
                        ${inputHtml}
                    `;
                }
                
                const itemHtml = `
                    <div class="flex items-start py-3 border-b border-gray-100">
                        <div class="flex-grow">
                            ${mainContentHtml}
                        </div>
                        <div class="flex-shrink-0 ml-4">
                            ${controlHtml}
                        </div>
                    </div>
                `;
                form.insertAdjacentHTML('beforeend', itemHtml);
            });
        }
        
        // --- Speichern in Firestore ---
        async function saveLog() {
            if (!firebaseEnabled || !isAuthReady || !currentUserId || isDummyMode) {
                saveStatus.textContent = 'FEHLER: Datenbankverbindung nicht aktiv oder Benutzer nicht authentifiziert. Speichern nicht möglich (Vorschau-Modus).';
                saveStatus.className = 'mt-2 text-sm text-center text-red-600 font-bold';
                saveStatus.style.display = 'block';
                return; 
            }

            const formData = new FormData(form);
            const logData = {
                userId: currentUserId,
                location: currentLocation,
                timestamp: new Date().toISOString(), 
                checks: {}
            };

            let allRequiredChecked = true;
            let firstMissingElement = null; 
            
            // Zurücksetzen aller Fehler-Markierungen
            document.querySelectorAll('[aria-invalid="true"]').forEach(el => el.removeAttribute('aria-invalid'));


            checklistItems.forEach(item => {
                const baseId = `check-${item.id}`;
                
                if (item.checkType === 'inventory') {
                    const value = formData.get(`${item.id}-val`);
                    const full = formData.get(`${item.id}-full`) === 'on';
                    
                    if (item.required && !value && !full) {
                         allRequiredChecked = false;
                         if (!firstMissingElement) firstMissingElement = document.getElementById(`${baseId}-val`);
                         document.getElementById(`${baseId}-val`).setAttribute('aria-invalid', 'true');
                    }
                    
                    logData.checks[item.id] = { 
                        value: value ? parseFloat(value) : null, 
                        isFull: full,
                        unit: item.unit
                    };
                } else if (item.checkType === 'text' || item.checkType === 'textarea') {
                    const value = formData.get(item.id) || '';
                    if (item.required && value.trim() === '') {
                        allRequiredChecked = false;
                        if (!firstMissingElement) firstMissingElement = document.getElementById(baseId);
                        document.getElementById(baseId).setAttribute('aria-invalid', 'true');
                    }
                    logData.checks[item.id] = value;
                } else {
                    const isChecked = formData.get(item.id) === 'on';
                    if (item.required && !isChecked) {
                        allRequiredChecked = false;
                        if (!firstMissingElement) firstMissingElement = document.getElementById(baseId);
                    }
                    logData.checks[item.id] = isChecked;
                }
            });

            if (!allRequiredChecked) {
                saveStatus.textContent = 'FEHLER: Bitte füllen Sie alle markierten (*) Pflichtfelder aus.';
                saveStatus.className = 'mt-2 text-sm text-center text-red-600 font-bold';
                saveStatus.style.display = 'block';

                if (firstMissingElement) {
                    firstMissingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    if (firstMissingElement.tagName === 'INPUT' || firstMissingElement.tagName === 'TEXTAREA') {
                         firstMissingElement.focus();
                    }
                }

                return;
            }

            // Tatsächlicher Speichervorgang
            try {
                // Pfad zur öffentlichen Collection für Protokolle
                const logsCollectionRef = collection(db, `artifacts/${appId}/public/data/logs`);
                const newLogRef = doc(logsCollectionRef); 
                await setDoc(newLogRef, logData);

                saveStatus.textContent = `Protokoll erfolgreich gespeichert am ${new Date().toLocaleTimeString('de-DE')}!`;
                saveStatus.className = 'mt-2 text-sm text-center text-emerald-600 font-bold';
                saveStatus.style.display = 'block';

                form.reset();
                renderChecklist();

            } catch (e) {
                saveStatus.textContent = `FEHLER beim Speichern: ${e.message}. Dies liegt wahrscheinlich an fehlenden Firestore-Regeln.`;
                saveStatus.className = 'mt-2 text-sm text-center text-red-600 font-bold';
                saveStatus.style.display = 'block';
                console.error("Firestore Speichern Fehler:", e);
            }
        }

        // --- Daten aus Firestore abrufen (Live-Listener) ---
        function listenForLogs() {
            if (!db || !isAuthReady || !firebaseEnabled || isDummyMode) { 
                return; 
            } 
            
            const logsCollectionRef = collection(db, `artifacts/${appId}/public/data/logs`);
            
            const logsQuery = query(logsCollectionRef, 
                limit(10) 
            );
            
            logList.innerHTML = '<p class="text-gray-500">Letzte Protokolle werden geladen...</p>';

            onSnapshot(logsQuery, (snapshot) => {
                const logs = [];
                snapshot.forEach((doc) => {
                    logs.push({ id: doc.id, ...doc.data() });
                });

                logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                renderLogs(logs);
            }, (error) => {
                console.error("Fehler beim Abrufen der Logs (onSnapshot):", error);
                logList.innerHTML = `<p class="text-red-600">Fehler beim Laden der Protokolle: ${error.message}. Prüfen Sie die Sicherheitsregeln!</p>`;
            });
        }
        
        // --- Anzeige der Protokolle im UI ---
        function renderLogs(logs) {
            if (logs.length === 0) {
                logList.innerHTML = '<p class="text-gray-500">Es wurden noch keine Protokolle gespeichert.</p>';
                return;
            }

            logList.innerHTML = logs.map(log => {
                const date = log.timestamp ? new Date(log.timestamp).toLocaleString('de-DE', { dateStyle: 'short', timeStyle: 'short' }) : 'Datum unbekannt';
                const userNameSnippet = log.userId ? `(${log.userId.substring(0, 8)}...)` : '';
                
                const checks = log.checks && typeof log.checks === 'object' && !Array.isArray(log.checks) ? log.checks : {};
                
                const detailEntries = Object.entries(checks).map(([key, value]) => {
                    let displayValue;
                    const item = checklistItems.find(i => i.id === key);

                    if (!item) return ''; 

                    if (item.checkType === 'inventory' && typeof value === 'object' && value !== null) {
                        const val = value.value !== null && value.value !== undefined ? `${value.value} ${value.unit || ''}` : '';
                        const status = value.isFull ? 'Auffüllen: JA' : '';
                        
                        if (!val && !status) return '';
                        displayValue = [val, status].filter(Boolean).join(' | ');
                    } else if (item.checkType === 'text' || item.checkType === 'textarea') {
                        if (!value || String(value).trim() === '') return '';
                        const strValue = String(value);
                        displayValue = strValue.length > 50 ? strValue.substring(0, 50) + '...' : strValue;
                    } else {
                        if (value !== true) return '';
                        displayValue = 'Erledigt ✅';
                    }

                    if (!displayValue) return '';

                    const itemText = item.text.split('(')[0].trim();

                    return `<li class="text-sm text-gray-700">${itemText}: <span class="font-medium">${displayValue}</span></li>`;
                }).join('');

                if (!detailEntries) {
                    return `
                        <div class="p-4 border border-gray-200 rounded-lg bg-white hover:bg-gray-50 transition duration-100">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-bold text-gray-900 text-lg">${log.location || 'Standort unbekannt'}</h3>
                                <span class="text-sm text-gray-500">${date}</span>
                            </div>
                            <p class="text-sm text-gray-500">Keine Details im Protokoll gefunden.</p>
                            <p class="text-xs text-right text-gray-400 mt-2">Erstellt von: ${userNameSnippet}</p>
                        </div>
                    `;
                }

                return `
                    <div class="p-4 border border-gray-200 rounded-lg bg-white hover:bg-gray-50 transition duration-100">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-gray-900 text-lg">${log.location || 'Standort unbekannt'}</h3>
                            <span class="text-sm text-gray-500">${date}</span>
                        </div>
                        <ul class="list-disc ml-5 space-y-1 text-gray-600 text-sm">
                            ${detailEntries}
                        </ul>
                        <p class="text-xs text-right text-gray-400 mt-2">Erstellt von: ${userNameSnippet}</p>
                    </div>
                `;
            }).join('');
        }

        // Starte die Anwendung
        window.onload = initializeFirebase;

    </script>
</body>
</html>